import os
import numpy as np
import pytest

from .utils import TestUtils


@pytest.mark.parametrize(
    "bionc_type",
    [
        "numpy",
        "casadi",
    ],
)
def test_biomech_model(bionc_type):
    if bionc_type == "casadi":
        from bionc.bionc_casadi import (
            BiomechanicalModel,
            SegmentNaturalVelocities,
            NaturalVelocities,
            SegmentNaturalCoordinates,
            NaturalCoordinates,
        )
    else:
        from bionc.bionc_numpy import (
            BiomechanicalModel,
            SegmentNaturalVelocities,
            NaturalVelocities,
            SegmentNaturalCoordinates,
            NaturalCoordinates,
        )

    bionc = TestUtils.bionc_folder()
    module = TestUtils.load_module(bionc + "/examples/model_creation.py")

    # Generate c3d file
    filename = module.generate_c3d_file()
    # Generate model
    natural_model = module.model_creation_from_measured_data(filename)

    # delete c3d file
    os.remove(filename)

    if bionc_type == "casadi":
        natural_model = natural_model.to_mx()

    # Test model
    assert natural_model.nb_segments() == 4
    assert natural_model.nb_markers() == 12
    assert natural_model.nb_joints() == 3
    assert natural_model.nb_joint_constraints() == 9
    assert natural_model.nb_rigid_body_constraints() == 6 * 4
    assert natural_model.nb_holonomic_constraints() == 9 + 6 * 4

    assert natural_model.nb_Q() == 48
    assert natural_model.nb_Qdot() == 48
    assert natural_model.nb_Qddot() == 48

    # Test rigid body constraints
    Q1 = SegmentNaturalCoordinates.from_components(
        u=[1, 2, 3.05],
        rp=[1.1, 1, 3.1],
        rd=[1.2, 2, 4.1],
        w=[1.3, 2, 5.1],
    )
    Q2 = SegmentNaturalCoordinates.from_components(
        u=[1.4, 2, 3.2],
        rp=[1.5, 1, 3.2],
        rd=[1.6, 2, 4.2],
        w=[1.7, 2, 5.2],
    )
    Q3 = SegmentNaturalCoordinates.from_components(
        u=[1.8, 2, 3.3],
        rp=[1.9, 1, 3.3],
        rd=[2.1, 2, 4.3],
        w=[2.2, 2, 5.3],
    )
    Q4 = SegmentNaturalCoordinates.from_components(
        u=[2.3, 2, 3.4],
        rp=[2.4, 1, 3.4],
        rd=[2.5, 2, 4.4],
        w=[2.6, 2, 5.4],
    )

    Q = NaturalCoordinates.from_qi((Q1, Q2, Q3, Q4))

    TestUtils.assert_equal(
        natural_model.rigid_body_constraints(Q),
        np.array(
            [
                13.3025,
                -5.12273904,
                20.8572729,
                1.97868761,
                -7.21835456,
                30.7,
                15.2,
                -5.07435059,
                23.19463501,
                1.85279006,
                -7.38308331,
                32.93,
                17.13,
                -5.58412845,
                25.3195383,
                1.91529346,
                -7.74909742,
                35.93,
                19.85,
                -5.72097005,
                28.5237567,
                1.9907063,
                -7.6571072,
                38.92,
            ]
        ),
        decimal=6,
    )

    TestUtils.assert_equal(
        natural_model.rigid_body_constraints_jacobian(Q),
        np.array(
            [
                [
                    2.0,
                    4.0,
                    6.1,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                ],
                [
                    -0.1,
                    -1.0,
                    -1.0,
                    1.0,
                    2.0,
                    3.05,
                    -1.0,
                    -2.0,
                    -3.05,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                ],
                [
                    1.3,
                    2.0,
                    5.1,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    1.0,
                    2.0,
                    3.05,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                ],
                [
                    0,
                    0,
                    0,
                    -0.2,
                    -2.0,
                    -2.0,
                    0.2,
                    2.0,
                    2.0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                ],
                [
                    0,
                    0,
                    0,
                    1.3,
                    2.0,
                    5.1,
                    -1.3,
                    -2.0,
                    -5.1,
                    -0.1,
                    -1.0,
                    -1.0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                ],
                [
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    2.6,
                    4.0,
                    10.2,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                ],
                [
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    2.8,
                    4.0,
                    6.4,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                ],
                [
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    -0.1,
                    -1.0,
                    -1.0,
                    1.4,
                    2.0,
                    3.2,
                    -1.4,
                    -2.0,
                    -3.2,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                ],
                [
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    1.7,
                    2.0,
                    5.2,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    1.4,
                    2.0,
                    3.2,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                ],
                [
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    -0.2,
                    -2.0,
                    -2.0,
                    0.2,
                    2.0,
                    2.0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                ],
                [
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    1.7,
                    2.0,
                    5.2,
                    -1.7,
                    -2.0,
                    -5.2,
                    -0.1,
                    -1.0,
                    -1.0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                ],
                [
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    3.4,
                    4.0,
                    10.4,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                ],
                [
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    3.6,
                    4.0,
                    6.6,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                ],
                [
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    -0.2,
                    -1.0,
                    -1.0,
                    1.8,
                    2.0,
                    3.3,
                    -1.8,
                    -2.0,
                    -3.3,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                ],
                [
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    2.2,
                    2.0,
                    5.3,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    1.8,
                    2.0,
                    3.3,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                ],
                [
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    -0.4,
                    -2.0,
                    -2.0,
                    0.4,
                    2.0,
                    2.0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                ],
                [
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    2.2,
                    2.0,
                    5.3,
                    -2.2,
                    -2.0,
                    -5.3,
                    -0.2,
                    -1.0,
                    -1.0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                ],
                [
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    4.4,
                    4.0,
                    10.6,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                ],
                [
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    4.6,
                    4.0,
                    6.8,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                ],
                [
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    -0.1,
                    -1.0,
                    -1.0,
                    2.3,
                    2.0,
                    3.4,
                    -2.3,
                    -2.0,
                    -3.4,
                    0,
                    0,
                    0,
                ],
                [
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    2.6,
                    2.0,
                    5.4,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    2.3,
                    2.0,
                    3.4,
                ],
                [
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    -0.2,
                    -2.0,
                    -2.0,
                    0.2,
                    2.0,
                    2.0,
                    0,
                    0,
                    0,
                ],
                [
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    2.6,
                    2.0,
                    5.4,
                    -2.6,
                    -2.0,
                    -5.4,
                    -0.1,
                    -1.0,
                    -1.0,
                ],
                [
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    5.2,
                    4.0,
                    10.8,
                ],
            ]
        ),
        decimal=6,
    )

    # Test rigid body constraint jacobian derivative
    Qdot1 = SegmentNaturalVelocities.from_components(
        udot=[1, 2, 3.05],
        rpdot=[1.1, 1, 3.1],
        rddot=[1.2, 2, 4.1],
        wdot=[1.3, 2, 5.1],
    )
    Qdot2 = SegmentNaturalVelocities.from_components(
        udot=[1.4, 2, 3.2],
        rpdot=[1.5, 1, 3.2],
        rddot=[1.6, 2, 4.2],
        wdot=[1.7, 2, 5.2],
    )
    Qdot3 = SegmentNaturalVelocities.from_components(
        udot=[1.8, 2, 3.3],
        rpdot=[1.9, 1, 3.3],
        rddot=[2.1, 2, 4.3],
        wdot=[2.2, 2, 5.3],
    )
    Qdot4 = SegmentNaturalVelocities.from_components(
        udot=[2.3, 2, 3.4],
        rpdot=[2.4, 1, 3.4],
        rddot=[2.5, 2, 4.4],
        wdot=[2.6, 2, 5.4],
    )

    Qdot = NaturalVelocities.from_qdoti((Qdot1, Qdot2, Qdot3, Qdot4))

    TestUtils.assert_equal(
        natural_model.rigid_body_constraint_jacobian_derivative(Qdot),
        np.array(
            [
                [
                    2.0,
                    4.0,
                    6.1,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                ],
                [
                    -0.1,
                    -1.0,
                    -1.0,
                    1.0,
                    2.0,
                    3.05,
                    -1.0,
                    -2.0,
                    -3.05,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                ],
                [
                    1.3,
                    2.0,
                    5.1,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    1.0,
                    2.0,
                    3.05,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                ],
                [
                    0,
                    0,
                    0,
                    -0.2,
                    -2.0,
                    -2.0,
                    0.2,
                    2.0,
                    2.0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                ],
                [
                    0,
                    0,
                    0,
                    1.3,
                    2.0,
                    5.1,
                    -1.3,
                    -2.0,
                    -5.1,
                    -0.1,
                    -1.0,
                    -1.0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                ],
                [
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    2.6,
                    4.0,
                    10.2,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                ],
                [
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    2.8,
                    4.0,
                    6.4,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                ],
                [
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    -0.1,
                    -1.0,
                    -1.0,
                    1.4,
                    2.0,
                    3.2,
                    -1.4,
                    -2.0,
                    -3.2,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                ],
                [
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    1.7,
                    2.0,
                    5.2,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    1.4,
                    2.0,
                    3.2,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                ],
                [
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    -0.2,
                    -2.0,
                    -2.0,
                    0.2,
                    2.0,
                    2.0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                ],
                [
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    1.7,
                    2.0,
                    5.2,
                    -1.7,
                    -2.0,
                    -5.2,
                    -0.1,
                    -1.0,
                    -1.0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                ],
                [
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    3.4,
                    4.0,
                    10.4,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                ],
                [
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    3.6,
                    4.0,
                    6.6,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                ],
                [
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    -0.2,
                    -1.0,
                    -1.0,
                    1.8,
                    2.0,
                    3.3,
                    -1.8,
                    -2.0,
                    -3.3,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                ],
                [
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    2.2,
                    2.0,
                    5.3,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    1.8,
                    2.0,
                    3.3,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                ],
                [
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    -0.4,
                    -2.0,
                    -2.0,
                    0.4,
                    2.0,
                    2.0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                ],
                [
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    2.2,
                    2.0,
                    5.3,
                    -2.2,
                    -2.0,
                    -5.3,
                    -0.2,
                    -1.0,
                    -1.0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                ],
                [
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    4.4,
                    4.0,
                    10.6,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                ],
                [
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    4.6,
                    4.0,
                    6.8,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                ],
                [
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    -0.1,
                    -1.0,
                    -1.0,
                    2.3,
                    2.0,
                    3.4,
                    -2.3,
                    -2.0,
                    -3.4,
                    0,
                    0,
                    0,
                ],
                [
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    2.6,
                    2.0,
                    5.4,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    2.3,
                    2.0,
                    3.4,
                ],
                [
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    -0.2,
                    -2.0,
                    -2.0,
                    0.2,
                    2.0,
                    2.0,
                    0,
                    0,
                    0,
                ],
                [
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    2.6,
                    2.0,
                    5.4,
                    -2.6,
                    -2.0,
                    -5.4,
                    -0.1,
                    -1.0,
                    -1.0,
                ],
                [
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    5.2,
                    4.0,
                    10.8,
                ],
            ]
        ),
        decimal=6,
    )

    # Test rigid body constraints
    Q1 = SegmentNaturalCoordinates.from_components(
        u=[1, 2, 3.05],
        rp=[1.1, 1, 3.1],
        rd=[1.2, 2, 4.1],
        w=[1.3, 2, 5.1],
    )
    Q2 = SegmentNaturalCoordinates.from_components(
        u=[1.4, 2, 3.2],
        rp=[1.5, 1, 3.2],
        rd=[1.6, 2, 4.2],
        w=[1.7, 2, 5.2],
    )
    Q3 = SegmentNaturalCoordinates.from_components(
        u=[1.8, 2, 3.3],
        rp=[1.9, 1, 3.3],
        rd=[2.1, 2, 4.3],
        w=[2.2, 2, 5.3],
    )
    Q4 = SegmentNaturalCoordinates.from_components(
        u=[2.3, 2, 3.4],
        rp=[2.4, 1, 3.4],
        rd=[2.5, 2, 4.4],
        w=[2.6, 2, 5.4],
    )

    Q = NaturalCoordinates.from_qi((Q1, Q3, Q2, Q4))

    TestUtils.assert_equal(
        natural_model.joint_constraints(Q),
        np.array([-0.7, 1.0, 0.8, 0.6, 1.0, 1.1, -0.8, 1.0, 0.8]),
    )

    TestUtils.assert_equal(
        natural_model.joint_constraints_jacobian(Q),
        np.array(
            [
                [
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    1.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    -1.0,
                    -0.0,
                    -0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                ],
                [
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    1.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    -0.0,
                    -1.0,
                    -0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                ],
                [
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    1.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    -0.0,
                    -0.0,
                    -1.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                ],
                [
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    1.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    -1.0,
                    -0.0,
                    -0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                ],
                [
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    1.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    -0.0,
                    -1.0,
                    -0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                ],
                [
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    1.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    -0.0,
                    -0.0,
                    -1.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                ],
                [
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    1.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    -1.0,
                    -0.0,
                    -0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                ],
                [
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    1.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    -0.0,
                    -1.0,
                    -0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                ],
                [
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    1.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    -0.0,
                    -0.0,
                    -1.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0,
                ],
            ]
        ),
    )

    # check the list of marker names
    marker_names = [
        "HIP_CENTER",
        "RKNI",
        "RKNE",
        "KNEE_JOINT",
        "KNEE_JOINT",
        "RANE",
        "RANI",
        "ANKLE_JOINT",
        "RHEE",
        "RTARI",
        "RTAR",
        "ANKLE_JOINT",
    ]
    assert natural_model.marker_names() == marker_names

    filename = "natural_model.nc"
    if bionc_type == "numpy":
        natural_model.save(filename)
        natural_model = BiomechanicalModel.load(filename)
        os.remove(filename)

    elif bionc_type == "casadi":
        # not implemented yet with casadi
        with pytest.raises(NotImplementedError):
            natural_model.save(filename)
        with pytest.raises(NotImplementedError):
            natural_model = BiomechanicalModel.load(filename)


@pytest.mark.parametrize(
    "bionc_type",
    [
        "numpy",
        "casadi",
    ],
)
def test_markers_constraint(bionc_type):
    if bionc_type == "casadi":
        from bionc.bionc_casadi import (
            SegmentNaturalVelocities,
            NaturalVelocities,
            SegmentNaturalCoordinates,
            NaturalCoordinates,
        )
    else:
        from bionc.bionc_numpy import (
            SegmentNaturalVelocities,
            NaturalVelocities,
            SegmentNaturalCoordinates,
            NaturalCoordinates,
        )

    bionc = TestUtils.bionc_folder()
    module = TestUtils.load_module(bionc + "/examples/model_creation.py")

    # Generate c3d file
    filename = module.generate_c3d_file()
    # Generate model
    natural_model = module.model_creation_from_measured_data(filename)

    # delete c3d file
    os.remove(filename)

    if bionc_type == "casadi":
        natural_model = natural_model.to_mx()

    # Test rigid body constraints
    Q1 = SegmentNaturalCoordinates.from_components(
        u=[1, 2, 3.05],
        rp=[1.1, 1, 3.1],
        rd=[1.2, 2, 4.1],
        w=[1.3, 2, 5.1],
    )
    Q2 = SegmentNaturalCoordinates.from_components(
        u=[1.4, 2, 3.2],
        rp=[1.5, 1, 3.2],
        rd=[1.6, 2, 4.2],
        w=[1.7, 2, 5.2],
    )
    Q3 = SegmentNaturalCoordinates.from_components(
        u=[1.8, 2, 3.3],
        rp=[1.9, 1, 3.3],
        rd=[2.1, 2, 4.3],
        w=[2.2, 2, 5.3],
    )
    Q4 = SegmentNaturalCoordinates.from_components(
        u=[2.3, 2, 3.4],
        rp=[2.4, 1, 3.4],
        rd=[2.5, 2, 4.4],
        w=[2.6, 2, 5.4],
    )

    Q = NaturalCoordinates.from_qi((Q1, Q3, Q2, Q4))

    np.random.seed(42)
    marker_data = np.random.random((3, natural_model.nb_markers()))

    TestUtils.assert_equal(
        natural_model.markers_constraints(marker_data, Q),
        np.array(
            [
                -1.52545988,
                -0.16755736,
                -2.84393002,
                -0.04928569,
                -0.78766089,
                -0.86482404,
                -2.46800606,
                -2.81817503,
                -6.75032622,
                -1.50134152,
                -1.81659549,
                -3.78576556,
                -1.34398136,
                -0.69575776,
                -2.60758543,
                -0.59400548,
                -0.47524357,
                -1.55354959,
                -2.39191639,
                -2.56805498,
                -6.19245515,
                -0.73382385,
                -1.70877086,
                -4.02947588,
                -14.73352396,
                -11.15378054,
                -30.29369839,
                -0.49192742,
                -0.86050614,
                -0.75111446,
                -3.77941551,
                -2.70785535,
                -6.13436797,
                -1.43009015,
                -0.63363816,
                -2.59160265,
            ]
        ),
    )
    TestUtils.assert_equal(
        natural_model.markers_constraints_jacobian(),
        np.array(
            [
                [
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    -0,
                    -0,
                    -0,
                    -1.0,
                    -0,
                    -0,
                    0,
                    0,
                    0,
                    -0,
                    -0,
                    -0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                ],
                [
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    -0,
                    -0,
                    -0,
                    -0,
                    -1.0,
                    -0,
                    0,
                    0,
                    0,
                    -0,
                    -0,
                    -0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                ],
                [
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    -0,
                    -0,
                    -0,
                    -0,
                    -0,
                    -1.0,
                    0,
                    0,
                    0,
                    -0,
                    -0,
                    -0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                ],
                [
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    -0,
                    -0,
                    -0,
                    -0,
                    -0,
                    -0,
                    -1.0,
                    -0,
                    -0,
                    5.0e-01,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                ],
                [
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    -0,
                    -0,
                    -0,
                    -0,
                    -0,
                    -0,
                    -0,
                    -1.0,
                    -0,
                    0,
                    5.0e-01,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                ],
                [
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    -0,
                    -0,
                    -0,
                    -0,
                    -0,
                    -0,
                    -0,
                    -0,
                    -1.0,
                    0,
                    0,
                    5.0e-01,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                ],
                [
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    -0,
                    -0,
                    -0,
                    -0,
                    -0,
                    -0,
                    -1.0,
                    -0,
                    -0,
                    -5.0e-01,
                    -0,
                    -0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                ],
                [
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    -0,
                    -0,
                    -0,
                    -0,
                    -0,
                    -0,
                    -0,
                    -1.0,
                    -0,
                    -0,
                    -5.0e-01,
                    -0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                ],
                [
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    -0,
                    -0,
                    -0,
                    -0,
                    -0,
                    -0,
                    -0,
                    -0,
                    -1.0,
                    -0,
                    -0,
                    -5.0e-01,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                ],
                [
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    -1.97691056e-18,
                    -0,
                    -0,
                    -0,
                    -0,
                    -0,
                    -1.0,
                    -0,
                    -0,
                    -1.18736348e-20,
                    -0,
                    -0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                ],
                [
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    -0,
                    -1.97691056e-18,
                    -0,
                    -0,
                    -0,
                    -0,
                    -0,
                    -1.0,
                    -0,
                    -0,
                    -1.18736348e-20,
                    -0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                ],
                [
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    -0,
                    -0,
                    -1.97691056e-18,
                    -0,
                    -0,
                    -0,
                    -0,
                    -0,
                    -1.0,
                    -0,
                    -0,
                    -1.18736348e-20,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                ],
                [
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    -0,
                    -0,
                    -0,
                    -1.0,
                    -0,
                    -0,
                    0,
                    0,
                    0,
                    -0,
                    -0,
                    -0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                ],
                [
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    -0,
                    -0,
                    -0,
                    -0,
                    -1.0,
                    -0,
                    0,
                    0,
                    0,
                    -0,
                    -0,
                    -0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                ],
                [
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    -0,
                    -0,
                    -0,
                    -0,
                    -0,
                    -1.0,
                    0,
                    0,
                    0,
                    -0,
                    -0,
                    -0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                ],
                [
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    -0,
                    -0,
                    -0,
                    -0,
                    -0,
                    -0,
                    -1.0,
                    -0,
                    -0,
                    5.0e-01,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                ],
                [
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    -0,
                    -0,
                    -0,
                    -0,
                    -0,
                    -0,
                    -0,
                    -1.0,
                    -0,
                    0,
                    5.0e-01,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                ],
                [
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    -0,
                    -0,
                    -0,
                    -0,
                    -0,
                    -0,
                    -0,
                    -0,
                    -1.0,
                    0,
                    0,
                    5.0e-01,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                ],
                [
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    -0,
                    -0,
                    -0,
                    -0,
                    -0,
                    -0,
                    -1.0,
                    -0,
                    -0,
                    -5.0e-01,
                    -0,
                    -0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                ],
                [
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    -0,
                    -0,
                    -0,
                    -0,
                    -0,
                    -0,
                    -0,
                    -1.0,
                    -0,
                    -0,
                    -5.0e-01,
                    -0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                ],
                [
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    -0,
                    -0,
                    -0,
                    -0,
                    -0,
                    -0,
                    -0,
                    -0,
                    -1.0,
                    -0,
                    -0,
                    -5.0e-01,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                ],
                [
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    -3.38821385e-18,
                    -0,
                    -0,
                    -0,
                    -0,
                    -0,
                    -1.0,
                    -0,
                    -0,
                    -1.18571527e-17,
                    -0,
                    -0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                ],
                [
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    -0,
                    -3.38821385e-18,
                    -0,
                    -0,
                    -0,
                    -0,
                    -0,
                    -1.0,
                    -0,
                    -0,
                    -1.18571527e-17,
                    -0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                ],
                [
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    -0,
                    -0,
                    -3.38821385e-18,
                    -0,
                    -0,
                    -0,
                    -0,
                    -0,
                    -1.0,
                    -0,
                    -0,
                    -1.18571527e-17,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                ],
                [
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    -3.84650117e-01,
                    -0,
                    -0,
                    -2.12258784e-01,
                    -0,
                    -0,
                    -7.87741216e-01,
                    -0,
                    -0,
                    -4.60429599e00,
                    -0,
                    -0,
                ],
                [
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    -0,
                    -3.84650117e-01,
                    -0,
                    -0,
                    -2.12258784e-01,
                    -0,
                    -0,
                    -7.87741216e-01,
                    -0,
                    -0,
                    -4.60429599e00,
                    -0,
                ],
                [
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    -0,
                    -0,
                    -3.84650117e-01,
                    -0,
                    -0,
                    -2.12258784e-01,
                    -0,
                    -0,
                    -7.87741216e-01,
                    -0,
                    -0,
                    -4.60429599e00,
                ],
                [
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    -1.06868478e-18,
                    -0,
                    -0,
                    -0,
                    -0,
                    -0,
                    -1.0,
                    -0,
                    -0,
                    5.0e-01,
                    0,
                    0,
                ],
                [
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    -0,
                    -1.06868478e-18,
                    -0,
                    -0,
                    -0,
                    -0,
                    -0,
                    -1.0,
                    -0,
                    0,
                    5.0e-01,
                    0,
                ],
                [
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    -0,
                    -0,
                    -1.06868478e-18,
                    -0,
                    -0,
                    -0,
                    -0,
                    -0,
                    -1.0,
                    0,
                    0,
                    5.0e-01,
                ],
                [
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    -0,
                    -0,
                    -0,
                    -0,
                    -0,
                    -0,
                    -1.0,
                    -0,
                    -0,
                    -5.0e-01,
                    -0,
                    -0,
                ],
                [
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    -0,
                    -0,
                    -0,
                    -0,
                    -0,
                    -0,
                    -0,
                    -1.0,
                    -0,
                    -0,
                    -5.0e-01,
                    -0,
                ],
                [
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    -0,
                    -0,
                    -0,
                    -0,
                    -0,
                    -0,
                    -0,
                    -0,
                    -1.0,
                    -0,
                    -0,
                    -5.0e-01,
                ],
                [
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    -0,
                    -0,
                    -0,
                    -1.0,
                    -0,
                    -0,
                    0,
                    0,
                    0,
                    -0,
                    -0,
                    -0,
                ],
                [
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    -0,
                    -0,
                    -0,
                    -0,
                    -1.0,
                    -0,
                    0,
                    0,
                    0,
                    -0,
                    -0,
                    -0,
                ],
                [
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    -0,
                    -0,
                    -0,
                    -0,
                    -0,
                    -1.0,
                    0,
                    0,
                    0,
                    -0,
                    -0,
                    -0,
                ],
            ]
        ),
    )


@pytest.mark.parametrize(
    "bionc_type",
    ["numpy", "casadi"],
)
def test_biomech_model_mass(bionc_type):
    if bionc_type == "casadi":
        from bionc.bionc_casadi import (
            SegmentNaturalVelocities,
            NaturalVelocities,
            SegmentNaturalCoordinates,
            NaturalCoordinates,
            NaturalSegment,
            BiomechanicalModel,
        )
    else:
        from bionc.bionc_numpy import (
            SegmentNaturalVelocities,
            NaturalVelocities,
            SegmentNaturalCoordinates,
            NaturalCoordinates,
            NaturalSegment,
            BiomechanicalModel,
        )

    my_segment = NaturalSegment(
        name="box",
        alpha=np.pi / 2,
        beta=np.pi / 2,
        gamma=np.pi / 2,
        length=1,
        mass=1,
        center_of_mass=np.array([0, 0, 0]),  # scs
        inertia=np.array([[1, 0, 0], [0, 1, 0], [0, 0, 1]]),  # scs
    )

    my_segment_2 = NaturalSegment(
        name="box2",
        alpha=np.pi / 2,
        beta=np.pi / 2,
        gamma=np.pi / 2,
        length=1,
        mass=1,
        center_of_mass=np.array([0, 0, 0]),  # scs
        inertia=np.array([[1, 0, 0], [0, 1, 0], [0, 0, 1]]),  # scs
    )

    model = BiomechanicalModel()
    model["box"] = my_segment
    model["box2"] = my_segment_2

    # Test rigid body constraints
    Q1 = SegmentNaturalCoordinates.from_components(
        u=[1, 2, 3.05],
        rp=[1.1, 1, 3.1],
        rd=[1.2, 2, 4.1],
        w=[1.3, 2, 5.1],
    )
    Q2 = SegmentNaturalCoordinates.from_components(
        u=[1.4, 2, 3.2],
        rp=[1.5, 1, 3.2],
        rd=[1.6, 2, 4.2],
        w=[1.7, 2, 5.2],
    )

    Q = NaturalCoordinates.from_qi((Q1, Q2))

    # Test rigid body constraint jacobian derivative
    Qdot1 = SegmentNaturalVelocities.from_components(
        udot=[1, 2, 3.05],
        rpdot=[1.1, 1, 3.1],
        rddot=[1.2, 2, 4.1],
        wdot=[1.3, 2, 5.1],
    )
    Qdot2 = SegmentNaturalVelocities.from_components(
        udot=[1.4, 2, 3.2],
        rpdot=[1.5, 1, 3.2],
        rddot=[1.6, 2, 4.2],
        wdot=[1.7, 2, 5.2],
    )

    Qdot = NaturalVelocities.from_qdoti((Qdot1, Qdot2))

    TestUtils.assert_equal(model.kinetic_energy(Qdot), 62.7312502)
    TestUtils.assert_equal(model.potential_energy(Q), 6.30000001)
    TestUtils.assert_equal(model.lagrangian(Q, Qdot), 56.4312502)

    G = np.array(
        [
            [
                1.0,
                0,
                0,
                -6.123234e-17,
                -0,
                -0,
                6.123234e-17,
                0,
                0,
                6.123234e-17,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
            ],
            [
                0,
                1.0,
                0,
                -0,
                -6.123234e-17,
                -0,
                0,
                6.123234e-17,
                0,
                0,
                6.123234e-17,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
            ],
            [
                0,
                0,
                1.0,
                -0,
                -0,
                -6.123234e-17,
                0,
                0,
                6.123234e-17,
                0,
                0,
                6.123234e-17,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
            ],
            [
                -6.123234e-17,
                -0,
                -0,
                2.0,
                0,
                0,
                -1.0,
                -0,
                -0,
                -6.123234e-17,
                -0,
                -0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
            ],
            [
                -0,
                -6.123234e-17,
                -0,
                0,
                2.0,
                0,
                -0,
                -1.0,
                -0,
                -0,
                -6.123234e-17,
                -0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
            ],
            [
                -0,
                -0,
                -6.123234e-17,
                0,
                0,
                2.0,
                -0,
                -0,
                -1.0,
                -0,
                -0,
                -6.123234e-17,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
            ],
            [
                6.123234e-17,
                0,
                0,
                -1.0,
                -0,
                -0,
                1.0,
                0,
                0,
                6.123234e-17,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
            ],
            [
                0,
                6.123234e-17,
                0,
                -0,
                -1.0,
                -0,
                0,
                1.0,
                0,
                0,
                6.123234e-17,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
            ],
            [
                0,
                0,
                6.123234e-17,
                -0,
                -0,
                -1.0,
                0,
                0,
                1.0,
                0,
                0,
                6.123234e-17,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
            ],
            [
                6.123234e-17,
                0,
                0,
                -6.123234e-17,
                -0,
                -0,
                6.123234e-17,
                0,
                0,
                1.0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
            ],
            [
                0,
                6.123234e-17,
                0,
                -0,
                -6.123234e-17,
                -0,
                0,
                6.123234e-17,
                0,
                0,
                1.0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
            ],
            [
                0,
                0,
                6.123234e-17,
                -0,
                -0,
                -6.123234e-17,
                0,
                0,
                6.123234e-17,
                0,
                0,
                1.0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
            ],
            [
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                1.0,
                0,
                0,
                -6.123234e-17,
                -0,
                -0,
                6.123234e-17,
                0,
                0,
                6.123234e-17,
                0,
                0,
            ],
            [
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                1.0,
                0,
                -0,
                -6.123234e-17,
                -0,
                0,
                6.123234e-17,
                0,
                0,
                6.123234e-17,
                0,
            ],
            [
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                1.0,
                -0,
                -0,
                -6.123234e-17,
                0,
                0,
                6.123234e-17,
                0,
                0,
                6.123234e-17,
            ],
            [
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                -6.123234e-17,
                -0,
                -0,
                2.0,
                0,
                0,
                -1.0,
                -0,
                -0,
                -6.123234e-17,
                -0,
                -0,
            ],
            [
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                -0,
                -6.123234e-17,
                -0,
                0,
                2.0,
                0,
                -0,
                -1.0,
                -0,
                -0,
                -6.123234e-17,
                -0,
            ],
            [
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                -0,
                -0,
                -6.123234e-17,
                0,
                0,
                2.0,
                -0,
                -0,
                -1.0,
                -0,
                -0,
                -6.123234e-17,
            ],
            [
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                6.123234e-17,
                0,
                0,
                -1.0,
                -0,
                -0,
                1.0,
                0,
                0,
                6.123234e-17,
                0,
                0,
            ],
            [
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                6.123234e-17,
                0,
                -0,
                -1.0,
                -0,
                0,
                1.0,
                0,
                0,
                6.123234e-17,
                0,
            ],
            [
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                6.123234e-17,
                -0,
                -0,
                -1.0,
                0,
                0,
                1.0,
                0,
                0,
                6.123234e-17,
            ],
            [
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                6.123234e-17,
                0,
                0,
                -6.123234e-17,
                -0,
                -0,
                6.123234e-17,
                0,
                0,
                1.0,
                0,
                0,
            ],
            [
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                6.123234e-17,
                0,
                -0,
                -6.123234e-17,
                -0,
                0,
                6.123234e-17,
                0,
                0,
                1.0,
                0,
            ],
            [
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                6.123234e-17,
                -0,
                -0,
                -6.123234e-17,
                0,
                0,
                6.123234e-17,
                0,
                0,
                1.0,
            ],
        ]
    )
    TestUtils.assert_equal(model.mass_matrix, G)
